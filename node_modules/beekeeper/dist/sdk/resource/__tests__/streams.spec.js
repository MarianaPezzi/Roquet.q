"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const node_fetch_1 = require("node-fetch");
const model_1 = require("../../../model");
const stream_1 = require("../stream");
const stream_json_1 = __importDefault(require("./__fixtures__/stream.json"));
const mockedFetch = window.fetch;
describe('StreamsResourceImpl', () => {
    const baseURL = 'https://tenant.beekeeper.rocks';
    let resource;
    beforeEach(() => {
        resource = new stream_1.StreamResourceImpl(baseURL);
    });
    afterEach(() => {
        mockedFetch.mockClear();
    });
    describe('.get()', () => {
        test('returns stream from API', async () => {
            const identifier = new model_1.NumericIdentifier(5376);
            mockedFetch.mockResolvedValue(new node_fetch_1.Response(JSON.stringify(stream_json_1.default)));
            const stream = await resource.get(identifier);
            expect(stream.id.toString()).toEqual('5376');
        });
        test('makes request to endpoint containing stream id', async () => {
            const identifier = new model_1.NumericIdentifier(5376);
            mockedFetch.mockResolvedValue(new node_fetch_1.Response(JSON.stringify(stream_json_1.default)));
            await resource.get(identifier);
            expect(mockedFetch).toBeCalled();
            const [call] = mockedFetch.mock.calls;
            const [url] = call;
            expect(url).toEqual('https://tenant.beekeeper.rocks/api/2/streams/5376');
        });
    });
});
